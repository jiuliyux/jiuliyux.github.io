<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>树木信息展示系统</title>
    <style>
        /* 页面布局样式 */
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .section {
            width: 80%;
            margin: 20px 0;
        }
        .map-container, .detailed-map-container {
            border: 1px solid #ccc;
            width: 100%;
            height: 400px;
            position: relative;
        }
        .tree-point, .location-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
        }
        #treeDetails {
            margin-top: 20px;
        }
        #threeDView {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 使用说明页面 -->
        <section id="instructions" class="section">
            <h2>使用说明</h2>
            <p>欢迎使用树木信息展示系统。首先在大地图页面中选择一个坐标点，然后在详细地图中查看该区域的树木信息。</p>
            <button onclick="showMapPage()">开始使用</button>
        </section>

        <!-- 大地图页面 -->
        <section id="mapPage" class="section" style="display: none;">
            <h2>大地图</h2>
            <div class="map-container" id="mapContainer"></div>
            <button onclick="showInstructionsPage()">返回使用说明</button>
        </section>

        <!-- 详细地图页面 -->
        <section id="detailedMapPage" class="section" style="display: none;">
            <h2>详细地图</h2>
            <div class="detailed-map-container" id="detailedMapContainer"></div>
            <button onclick="showMapPage()">返回大地图</button>
        </section>

        <!-- 树木信息页面 -->
        <section id="treeInfoPage" class="section" style="display: none;">
            <h2>树木信息</h2>
            <div id="threeDView"></div>
            <div id="treeDetails">
                <p id="treeHeight">树高: --</p>
                <p id="treeDiameter">胸径: --</p>
                <p id="carbonStorage">碳储量: --</p>
            </div>
            <button onclick="showDetailedMapPage()">返回详细地图</button>
        </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 页面切换函数
        function showInstructionsPage() {
            document.getElementById('instructions').style.display = 'block';
            document.getElementById('mapPage').style.display = 'none';
            document.getElementById('detailedMapPage').style.display = 'none';
            document.getElementById('treeInfoPage').style.display = 'none';
        }

        function showMapPage() {
            document.getElementById('instructions').style.display = 'none';
            document.getElementById('mapPage').style.display = 'block';
            document.getElementById('detailedMapPage').style.display = 'none';
            document.getElementById('treeInfoPage').style.display = 'none';
            fetchData(); // 加载数据
        }

        function showDetailedMapPage() {
            document.getElementById('mapPage').style.display = 'none';
            document.getElementById('detailedMapPage').style.display = 'block';
            document.getElementById('treeInfoPage').style.display = 'none';
        }

        function showTreeInfoPage() {
            document.getElementById('detailedMapPage').style.display = 'none';
            document.getElementById('treeInfoPage').style.display = 'block';
        }

        // 数据获取与展示
        async function fetchData() {
            try {
                const locationPointsResponse = await fetch('https://raw.githubusercontent.com/your-username/your-repo/main/locationPoints.json');
                const treeDataResponse = await fetch('https://raw.githubusercontent.com/your-username/your-repo/main/treeData.json');

                const locationPoints = await locationPointsResponse.json();
                const treeData = await treeDataResponse.json();

                initializeMap(locationPoints, treeData); // 初始化大地图
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('请确保已正确配置数据文件并更新GitHub链接');
            }
        }

        function initializeMap(locationPoints, treeData) {
            const mapContainer = document.getElementById('mapContainer');
            locationPoints.forEach((point, index) => {
                const marker = document.createElement('div');
                marker.className = 'location-point';
                marker.style.left = point.x + 'px';
                marker.style.top = point.y + 'px';
                marker.title = `位置 ${index + 1}`;
                
                marker.addEventListener('click', () => {
                    showDetailedMap(point.locationId, treeData);
                });
                
                mapContainer.appendChild(marker);
            });
        }

        function showDetailedMap(locationId, treeData) {
            const detailedMapContainer = document.getElementById('detailedMapContainer');
            detailedMapContainer.style.display = 'block';

            const locationData = treeData[locationId];
            const map = document.getElementById('detailedMapContainer');
            map.innerHTML = ''; // 清空已有内容

            locationData.points.forEach((point, index) => {
                const marker = document.createElement('div');
                marker.className = 'tree-point';
                marker.style.left = point.x + 'px';
                marker.style.top = point.y + 'px';
                marker.title = `树木 ${index + 1}`;
                
                marker.addEventListener('click', () => {
                    showTreeDetails(point);
                });

                map.appendChild(marker);
            });
        }

        function showTreeDetails(tree) {
            showTreeInfoPage();  // 显示树木信息页面

            document.getElementById('treeHeight').textContent = `树高: ${tree.height} m`;
            document.getElementById('treeDiameter').textContent = `胸径: ${tree.diameter} cm`;
            document.getElementById('carbonStorage').textContent = `碳储量: ${tree.carbonStorage} kg`;

            const threeDView = document.getElementById('threeDView');
            threeDView.style.display = 'block';

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, threeDView.clientWidth / threeDView.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(threeDView.clientWidth, threeDView.clientHeight);
            threeDView.innerHTML = '';
            threeDView.appendChild(renderer.domElement);

            const geometry = new THREE.CylinderGeometry(0.5, 0.5, tree.height, 32);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const cylinder = new THREE.Mesh(geometry, material);
            scene.add(cylinder);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
        }

        // 初始页面：加载使用说明
        showInstructionsPage();
    </script>
</body>
</html>

